[gd_scene load_steps=4 format=2]

[ext_resource path="res://Graphics/Player.png" type="Texture" id=1]

[sub_resource type="GDScript" id=1]
script/source = "extends KinematicBody2D

var energy = 100.0
var hp     = 100.0

var direction    = Vector2(0,0)

var target_point = position
var speed         = 0
var speed_incease = 25
var speed_max     = 150

var boost_bonus = 0
var boost_cost  = 25
var boost_max   = 350

var lock_move   = 0

func _ready():
	pass # Replace with function body.

func update_hp(delta):
	hp -= 1 * delta 

func _process(delta):
	update_hp(delta)

func _input(event):
	if(Input.is_mouse_button_pressed(BUTTON_LEFT) and not boost_bonus):
		target_point = get_viewport().get_mouse_position()
		var origin_position = get_global_transform_with_canvas().origin
		direction = (target_point  - origin_position).normalized()
	
	if(Input.is_mouse_button_pressed(BUTTON_RIGHT) and not boost_bonus):
		if energy < boost_cost: return
		
		target_point = get_viewport().get_mouse_position()
		energy    -=  boost_cost 
		
		speed       = speed_max
		boost_bonus = boost_max
		var origin_position = get_global_transform_with_canvas().origin
		direction = (target_point  - origin_position).normalized()

func move_character(delta):
	boost_bonus = max( boost_bonus- speed_max*delta, 0 )
	
	if(Input.is_mouse_button_pressed(BUTTON_LEFT) and not boost_bonus):
		speed = min( speed_incease*delta + speed, speed_max)
	else: speed = max( speed - 2*speed_incease*delta, 0 ) 
	var velocity = delta * direction * ( speed + boost_bonus )
	
	if not boost_bonus: pass
	else: target_point = get_global_transform_with_canvas().origin
	position += velocity

func rotate_character(delta):
	
	var angle      = get_global_transform_with_canvas().origin.angle_to_point(target_point)
	var angle_diff = ( angle - deg2rad($Player.rotation_degrees) ) * delta
	#print( angle_diff) 
	$Player.rotation_degrees = rad2deg(angle)#$Player.rotation_degrees + rad2deg(angle_diff)
	#print( angle )


func _physics_process(delta):
	move_character(delta)
	rotate_character(delta)
	
"

[sub_resource type="CircleShape2D" id=2]
radius = 113.687

[node name="KinematicBody2D" type="KinematicBody2D"]
script = SubResource( 1 )

[node name="Player" type="Sprite" parent="." groups=[
"player",
]]
scale = Vector2( 0.2, 0.2 )
texture = ExtResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
scale = Vector2( 0.2, 0.2 )
shape = SubResource( 2 )

[node name="Camera2D" type="Camera2D" parent="."]
current = true
zoom = Vector2( 0.5, 0.5 )
editor_draw_limits = true
editor_draw_drag_margin = true
